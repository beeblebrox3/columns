!function(t){"use strict";t.Columns=function(e){function n(e,n){var i,s,c,l="",d="",r={},p="";return s=e[o.options.label],c=e[o.options.value],r=t.extend(r,o.options.attrs),r["data-label"]=s,o.options.checkboxes===!0&&(l='<input type="checkbox" value="'+c+'"',e.hasOwnProperty("checked")&&e.checked===!0&&(l+=" checked "),l+="/>"),o.options.radio===!0&&(d='<input type="radio" name="'+o.privateOptions.id+'" value="'+c+'"',e.hasOwnProperty("checked")&&e.checked===!0&&(d+=" checked "),d+="/>"),o.options.mapAttr===!0&&t.each(e,function(t,e){t!==o.options.value&&t!==o.options.label&&("string"!=typeof t||"string"!=typeof e&&"number"!=typeof e||(r["data-"+t]=e))}),o.options.editLinks&&(p='<span class="columns-edit-item">edit</span>'),r["data-id"]=c,i=t("<li>"+d+l+s+p+"</li>"),i.attr(r),e.hasOwnProperty("child")?i.append(a(e.child,n+1,c)):o.options.addLinks&&i.append(a([],n+1,c)),i}function a(e,a,i){var s=t('<ul class="columns-level" data-columnslevel="'+a+'"></ul>');return void 0!==i?s.attr("data-rel",i):s.addClass(o.options.activeClass),t.each(e,function(t,e){s.append(n(e,a))}),o.options.addLinks&&s.append(t('<li class="columns-add-item">'+o.options.addLinksLabel+"</li>")),s}var i,o={};if(i={checkboxes:!1,radio:!1,activeClass:"active",mapAttr:!1,container:"",label:"label",value:"id",addLinks:!1,addLinksLabel:"New item",editLinks:!1,attrs:{}},o.data=[],o.options=t.extend(i,e),o.privateOptions={id:"columns-"+Math.random()},e.checkboxes&&e.radio)throw"Only checkboxes OR radio, not both";if(o.options.container=t(o.options.container),"object"!=typeof o.options.container||"function"!=typeof o.options.container.css)throw"There's no object with this selector: '"+o.options.container+"'";if(1!==o.options.container.size())throw"We need a single element to build the columns. No more, no less.";return o.options.container.addClass("columns-container"),this.loadData=function(t){if("object"!=typeof t)throw"data MUST be a object";o.data=t},this.update=function(e){var n={keepSelection:!0,data:null},a=[],i=[],s=0;if(e=t.extend(n,e),null!==e.data&&this.loadData(e.data),e.keepSelection===!0&&(i=this.getSelected(),a=this.getActives()),this.render(),e.keepSelection===!0){if(i.lengh)for(s=0;s<i.length;s++)o.options.container.find('[value="'+i[s]+'"]').prop("checked",!0);if(a.length)for(s=0;s<a.length;s++)o.options.container.find('[data-id="'+a[s]+'"]').click()}},this.getActives=function(){var e=[],n="li."+o.options.activeClass;return o.options.container.find(n).each(function(){e.push(t(this).attr("data-id"))}),e},this.getSelected=function(){var e=[];return o.options.container.find(":checked").each(function(){e.push(t(this).val())}),e},this.render=function(){var t=a(o.data,0);o.options.container.html("").append(t)},this.reset=function(){o.options.container.find(".columns-level."+o.options.activeClass).each(function(){var e=t(this),n=e.attr("data-rel"),a=t('[data-id="'+n+'"]');e.removeClass(o.options.activeClass).find("."+o.options.activeClass).removeClass(o.options.activeClass).end().appendTo(a)}).end().find(":checked").each(function(){t(this).prop("checked",!1)})},this.getData=function(){return JSON.parse(JSON.stringify(o.data))},o.options.container.on("click",".columns-edit-item",function(e){e.stopPropagation();var n=t(this).parents("li:first"),a=n.attr("data-id"),i=n.attr("data-label");o.options.editLinks(a,i)}),o.options.container.on("click","li",function(){var e,n,a,i;if(n=t(this),!n.hasClass(o.options.activeClass)){if(n.hasClass("columns-add-item")){var s=t(this).parents("ul:first").attr("data-rel");return void o.options.addLinks(s)}e=n.parents("ul:first"),a=n.find("ul:first"),i=parseInt(e.attr("data-columnslevel"),10),o.options.container.find(".columns-level."+o.options.activeClass).each(function(){var e,n,a,s;e=t(this),n=parseInt(e.attr("data-columnslevel"),10),n>i&&(a=e.attr("data-rel"),s=t('[data-id="'+a+'"]'),e.removeClass(o.options.activeClass).find("."+o.options.activeClass).removeClass(o.options.activeClass).end().appendTo(s))}),a.size()&&a.addClass(o.options.activeClass).insertAfter(e),n.addClass(o.options.activeClass).siblings().removeClass(o.options.activeClass),t(".columns-container").animate({scrollLeft:1e3},100)}}),void 0!==o.options.data&&(this.loadData(o.options.data),this.render()),this}}(jQuery);